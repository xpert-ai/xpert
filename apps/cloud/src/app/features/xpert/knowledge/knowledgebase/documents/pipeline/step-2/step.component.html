<div class="h-full min-w-0 flex-1">
  <div class="flex h-full flex-col px-14">
    <div class="relative flex flex-col gap-y-0.5 pb-2 pt-4">
      <div class="flex items-center gap-x-2">
        <span class="text-xs font-semibold uppercase bg-gradient-to-br from-[rgba(11,165,236,0.95)] to-[rgba(21,90,239,0.95)] bg-clip-text text-transparent"
          >{{ 'PAC.Knowledgebase.AddDocuments' | translate: {Default: 'Add Documents'} }}</span
        ><span class="system-2xs-regular text-divider-regular">/</span>
        <div class="flex gap-x-1">
          <div class="h-1 w-1 rounded-lg bg-divider-deep"></div>
          <div class="h-1 rounded-lg w-2 bg-primary-600"></div>
          <div class="h-1 w-1 rounded-lg bg-divider-deep"></div>
        </div>
      </div>
      <div class="system-md-semibold text-text-primary">{{ 'PAC.Knowledgebase.ProcessingDocuments' | translate: {Default: 'Processing Documents'} }}</div>
      <a [routerLink]="['../']" class="cursor-pointer">
        <button
          type="button"
          class="btn disabled:btn-disabled btn-secondary-accent btn-medium absolute -left-11 top-3.5 size-9 rounded-full p-0"
        ><i class="ri-arrow-left-line"></i>
        </button>
      </a>
      <div class="absolute size-[112px] rounded-full bg-util-colors-blue-brand-blue-brand-500 blur-[80px] left-8 top-[-34px] opacity-20"></div>
    </div>
    <div class="grow overflow-y-auto">
      <div class="flex flex-col gap-y-4 pt-4">
        <div class="flex w-full flex-col rounded-lg border border-components-panel-border bg-components-panel-bg">
          <div class="flex items-center gap-x-1 px-4 py-2">
            <div class="system-sm-semibold-uppercase grow text-text-secondary">{{ 'PAC.Knowledgebase.ChunkSettings' | translate: {Default: 'Chunk Settings'} }}</div>
            <button type="button" class="btn disabled:btn-disabled btn-ghost btn-medium" disabled="">
              {{ 'PAC.ACTIONS.Reset' | translate: {Default: 'Reset'} }}
            </button>
            <button type="button" class="btn disabled:btn-disabled btn-secondary-accent btn-medium gap-x-0.5"
              (click)="previewChunks()">
              <i class="ri-eye-2-line"></i>
              <span class="px-0.5">{{ 'PAC.Knowledgebase.PreviewChunks' | translate: {Default: 'Preview Chunks'} }}</span>
            </button>
          </div>
          <div class="flex flex-col gap-3 border-t border-divider-subtle px-4 py-3">
            @if (parameters(); as parameters) {
              <xpert-parameters-form class="w-full" [readonly]="loading()" 
                [parameters]="parameters"
                [(ngModel)]="parametersValue"
              />
            }
          </div>
        </div>
        <div class="flex items-center justify-between">
          <button type="button" class="btn disabled:btn-disabled btn-secondary btn-medium gap-x-0.5"
            (click)="previousStep()">
            <i class="ri-arrow-left-line"></i>
            <span class="px-0.5">{{ 'PAC.Knowledgebase.DocumentSource' | translate: {Default: 'Document Source'} }}</span>
          </button>
          <button type="button" class="btn disabled:btn-disabled btn-primary btn-medium"
            (click)="saveAndProcess()">{{ 'PAC.Knowledgebase.SaveAndProcess' | translate: {Default: 'Save and Process'} }}</button>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="h-full min-w-0 flex-1">
  <div class="flex h-full flex-col pl-2 pt-2">
    <div class="relative flex h-full w-full shrink-0">
      <div
        class="flex h-full w-full flex-col rounded-tl-xl border-l-[0.5px] border-t-[0.5px] border-components-panel-border bg-background-default-lighter shadow-md shadow-shadow-shadow-5"
      >
        <header class="border-b border-divider-subtle pb-3 pl-5 pr-4 pt-4">
          <div class="">
            <div class="system-2xs-semibold-uppercase mb-1 px-1 uppercase text-text-accent">{{ 'PAC.KEY_WORDS.Preview' | translate: {Default: 'Preview'} }}</div>
            <div class="flex items-center gap-1">
              <div class="inline-block" >
                <div class="flex h-6 select-none items-center rounded-md px-1 hover:bg-state-base-hover"
                  [cdkMenuTriggerFor]="docsMenu">
                  <svg
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="currentColor"
                    class="remixicon shrink-0 size-5 text-[#309BEC]"
                  >
                    <path
                      d="M3 3H21C21.5523 3 22 3.44772 22 4V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V4C2 3.44772 2.44772 3 3 3ZM7 15.5V11.5L9 13.5L11 11.5V15.5H13V8.5H11L9 10.5L7 8.5H5V15.5H7ZM18 12.5V8.5H16V12.5H14L17 15.5L20 12.5H18Z"
                    ></path>
                  </svg>
                  <div class="ml-1 flex flex-col items-start">
                    <div class="flex items-center space-x-0.5">
                      <span class="system-md-semibold max-w-[200px] truncate text-text-primary">
                        {{ previewDocName() || ('PAC.Knowledgebase.SelectDocumentForPreview' | translate: {Default: 'Select a document to preview its content'}) }}
                      </span>
                      <svg
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        fill="currentColor"
                        class="remixicon h-[18px] w-[18px] text-text-primary"
                      >
                        <path
                          d="M11.9999 13.1714L16.9497 8.22168L18.3639 9.63589L11.9999 15.9999L5.63599 9.63589L7.0502 8.22168L11.9999 13.1714Z"
                        ></path>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="relative inline-flex h-5 items-center rounded-[5px] border border-divider-deep px-[5px] leading-3 text-text-tertiary system-2xs-medium-uppercase"
              >
                0 {{ 'PAC.Knowledgebase.EstimatedChunks' | translate: {Default: 'Estimated Chunks'} }}
              </div>
            </div>
          </div>
        </header>
        <main class="w-full grow overflow-y-auto px-6 py-5 space-y-2">
          @if (previewing()) {
            <bullet-list-content-loader class="w-full" />
          } @else if (previewDocName()) {
            @for (chunk of previewDocChunks(); track chunk; let i = $index) {
              <xp-knowledge-chunk [chunk]="chunk" [index]="i" />
            }
          } @else {
            <div class="flex h-full w-full items-center justify-center">
              <div class="flex flex-col items-center justify-center gap-3 pb-4">
                <i class="ri-eye-2-line text-2xl"></i>
                <p class="text-sm text-text-tertiary">
                  {{ 'PAC.Knowledgebase.PreviewDocHint' | translate: {Default: 'Click the "Document" button on the left to load a preview'} }}
                </p>
                <button type="button" class="btn disabled:btn-disabled btn-secondary btn-medium"
                  (click)="previewChunks()">{{ 'PAC.Knowledgebase.PreviewChunks' | translate: {Default: 'Preview Chunks'} }}</button>
              </div>
            </div>
          }
        </main>
      </div>
    </div>
  </div>
</div>


<ng-template #docsMenu >
  <div cdkMenu class="cdk-menu__large" >
    @for (option of files(); track option.file) {
      <div cdkMenuItem class="flex select-none items-center" (click)="selectFilePreview(option)" >
        <svg
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          fill="currentColor"
          class="remixicon shrink-0 size-5 text-[#309BEC]"
        >
          <path
            d="M3 3H21C21.5523 3 22 3.44772 22 4V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V4C2 3.44772 2.44772 3 3 3ZM7 15.5V11.5L9 13.5L11 11.5V15.5H13V8.5H11L9 10.5L7 8.5H5V15.5H7ZM18 12.5V8.5H16V12.5H14L17 15.5L20 12.5H18Z"
          ></path>
        </svg>
        <div class="ml-1 flex flex-col items-start">
          <div class="flex items-center space-x-0.5">
            <span class="system-md-semibold max-w-[200px] truncate text-text-primary">
              {{option.file.name }}</span>
          </div>
        </div>
      </div>
    } @empty {
      @for (option of documents(); track option.filePath) {
        <div cdkMenuItem class="group/item overflow-hidden" (click)="previewDocName.set(option.name)" >
          <div class="max-w-full flex flex-col items-start overflow-hidden">
            <div class="text-start">{{option.name}}</div>
          </div>
        </div>
      } @empty {
        <div class="p-4 text-center text-text-tertiary">
          {{ 'PAC.Knowledgebase.NoDocumentYet' | translate: {Default: 'No document yet!'} }}
        </div>
      }
    }
  </div>
</ng-template>