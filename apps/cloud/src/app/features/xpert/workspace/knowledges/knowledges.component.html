<nav class="relative content-start gap-4 pt-2 pb-4 grow shrink-0"
  ngmDynamicGrid colWidth="280"
  box="content-box"
  >
  <div class="flex min-h-[160px] flex-col p-2 space-y-2 rounded-xl border-[0.5px] border-components-panel-border transition-all duration-200 ease-in-out bg-gray-200">
    <a class="group flex cursor-pointer items-start p-2 rounded-lg hover:bg-components-card-bg"
      (click)="newKnowledgebase()">
      <div class="flex items-center gap-3">
        <div class="flex h-10 w-10 items-center justify-center rounded-lg border border-dashed border-divider-deep bg-neutral-50 p-2
          group-hover:border-solid group-hover:border-divider-deep group-hover:bg-components-card-bg">
          <i class="ri-add-line text-text-tertiary"></i>
        </div>
        <div class="system-md-semibold text-text-secondary group-hover:text-text-accent">{{ 'PAC.Knowledgebase.AddKnowledgebase' | translate: {Default: 'Add knowledgebase'} }}</div>
      </div>
    </a>
    <a type="button" class="flex w-full items-center gap-x-2 rounded-lg bg-transparent px-4 py-2 cursor-pointer text-text-tertiary
      shadow-shadow-shadow-3 hover:bg-components-card-bg hover:text-text-secondary hover:shadow-sm"
      [routerLink]="['/xpert/knowledges/create-from-pipeline']" [queryParams]="{ workspaceId: workspaceId() }"
      >
      <i class="ri-mind-map"></i>
      <span class="system-sm-medium grow text-left">
        {{ 'PAC.Knowledgebase.CreateFromKnowledgePipeline' | translate: {Default: 'Create from Knowledge Pipeline'} }}
      </span>
    </a>
    <div class="grow"></div>
    <a class="group flex cursor-pointer items-center gap-1 rounded-lg border-t-[0.5px] border-neutral-100 p-2
      text-text-tertiary hover:bg-components-card-bg hover:text-text-accent"
      [routerLink]="['/xpert/knowledges/connect']" [queryParams]="{ workspaceId: workspaceId() }">
      <i class="ri-plug-line"></i>
      <div class="text-sm font-mono">{{ 'PAC.Knowledgebase.ConnectExternalKnowledgebase' | translate: {Default: 'Connect External Knowledgebase'} }}</div>
      <i class="ri-arrow-right-line"></i>
    </a>
  </div>

  @for (item of knowledgebases(); track item.id) {
    <div class="ngm-card group relative min-h-[160px] flex-1 flex flex-col p-4 overflow-hidden cursor-pointer bg-components-card-bg hover:bg-white"
      (click)="openKnowledgebase(item.id)">
      <div class="flex-1">
        <div class="flex items-start gap-2">
          <emoji-avatar [avatar]="item.avatar" class="shrink-0 rounded-md overflow-hidden shadow-sm" />

          <div class="flex flex-col items-start overflow-hidden">
            <p class="text-xs flex items-center text-token-text-secondary opacity-80">
              @if (item.permission === KnowledgebasePermission.Public || item.permission === KnowledgebasePermission.Organization) {
                <i class="ri-earth-line mr-1"></i>
                {{ 'PAC.Knowledgebase.Permission_Public' | translate: {Default:'Public'} }}
              } @else {
                <i class="ri-git-repository-private-line mr-1"></i>
                {{ 'PAC.Knowledgebase.Permission_Private' | translate: {Default:'Private'} }}
              }
            </p>
            <div class="max-w-full font-bold text-base truncate" [title]="item.name">{{item.name}}</div>
          </div>

        </div>

        <div class="w-full pt-2 text-sm font-thin overflow-hidden line-clamp-3 text-text-secondary" [title]="item.description">
          {{item.description}}
        </div>
        
      </div>

      <div class="flex justify-between items-end">
        <pac-user-profile-inline [user]="item.createdBy" small class="mt-2" />

        <!-- <a class="inline-block cursor-pointer" (click)="openKnowledgebase(item.id)">
          <button
            class="flex items-center gap-2 px-4 py-2 font-sans text-xs font-bold text-center whitespace-nowrap text-zinc-600 uppercase align-middle transition-all rounded-lg select-none disabled:opacity-50 disabled:shadow-none disabled:pointer-events-none
              hover:bg-gray-900/10 active:bg-gray-900/20 hover:text-zinc-800
              dark:text-zinc-200 dark:hover:bg-neutral-700 dark:active:bg-neutral-500"
            type="button">
            {{'PAC.KEY_WORDS.Open' | translate: {Default: 'Open'} }}

            <i class="ri-arrow-right-line ml-2"></i>
          </button>
        </a> -->
      </div>

      <div class="absolute right-2 top-2 z-[5] hidden group-hover:block">
        <button type="button" class="group inline-flex items-center text-base font-medium hover:bg-components-button-secondary-bg-hover focus:outline-none w-9 h-9 cursor-pointer justify-center rounded-[10px] border-[0.5px]
          border-components-actionbar-border bg-components-actionbar-bg p-0 shadow-lg shadow-shadow-shadow-5
          ring-[2px] ring-inset ring-gray-100 hover:border-components-actionbar-border"
          #mt="cdkMenuTriggerFor"
          [cdkMenuTriggerFor]="menu"
          [cdkMenuTriggerData]="{item: item}"
          [class.active]="mt.isOpen()"
          (click)="$event.stopPropagation()">
          <div class="flex w-8 h-8 items-center justify-center rounded-[10px] hover:bg-state-base-hover">
            <i class="ri-more-fill text-lg text-text-tertiary"></i>
          </div>
        </button>
      </div>
    </div>
  }
</nav>

<ng-template #menu let-item="item">
  <div class="ngm-cdk-menu p-2" cdkMenu>
    <button cdkMenuItem class="ngm-cdk-menu-item p-1" (click)="edit(item)">
      <i class="ri-pencil-line mr-1"></i>
      <span>
        {{ 'PAC.ACTIONS.Edit' | translate: {Default: "Edit"} }}
      </span>
    </button>

    <button cdkMenuItem ngmAppearance="danger" class="ngm-cdk-menu-item p-1" (click)="remove(item)">
      <i class="ri-delete-bin-line mr-1"></i>
      <span>{{ 'PAC.ACTIONS.Delete' | translate: {Default: "Delete"} }}</span>
    </button>
  </div>
</ng-template>
