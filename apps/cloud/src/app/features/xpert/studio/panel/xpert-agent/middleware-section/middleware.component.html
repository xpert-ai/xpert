<div class="flex items-center gap-1 px-2 py-1">
  <i class="ri-stack-fill text-indigo-500"></i>
  <div class="text-sm font-semibold text-text-secondary">{{ 'PAC.KEY_WORDS.Middleware' | translate: {Default: 'Middleware'} }}</div>
  <i class="ri-information-2-line text-text-tertiary opacity-50 hover:opacity-100"
    [matTooltip]="'PAC.Xpert.AgentMiddlewaresTooltip' | translate: {Default: 'The agent loads middleware sequentially. Middleware can perform the following tasks: Tracking agent behavior with logging, analytics, and debugging; Transforming prompts, tool selection, and output formatting; Adding retries, fallbacks, and early termination logic; Applying rate limits, guardrails, and PII detection.'}"
    matTooltipPosition="above"
  ></i>
</div>
<div class="flex flex-col gap-1" cdkDropList (cdkDropListDropped)="drop($event)">
  @for (middleware of middlewares(); track middleware.node.key; let index = $index) {
    <div
      class="group flex items-start gap-2 px-2 py-3 rounded-xl bg-components-card-bg border border-divider-regular shadow-sm"
      cdkDrag
      cdkDragLockAxis="y"
    >
      <i class="ri-draggable mt-0.5 cursor-grab text-text-tertiary opacity-50 group-hover:opacity-100" cdkDragHandle></i>

      @if (middleware.strategy?.meta.icon; as icon) {
        <xp-icon [icon]="icon" class="w-8 h-8 shrink-0 rounded-lg bg-components-panel-bg flex items-center justify-center" />
      } @else {
        <div
          class="w-8 h-8 shrink-0 rounded-lg bg-components-panel-bg flex items-center justify-center text-text-tertiary text-xs uppercase"
        >
          {{ middleware.strategy?.meta.name?.[0] || middleware.node.key?.[0] }}
        </div>
      }

      <div class="min-w-0 flex flex-col gap-1">
        <div class="flex items-center gap-2 min-w-0">
          <div class="text-text-primary system-sm-medium truncate">
            {{
              middleware.strategy?.meta.label
                ? (middleware.strategy?.meta.label | i18n)
                : middleware.strategy?.meta.name || middleware.node.key
            }}
          </div>
          <div class="text-text-tertiary text-xs font-mono truncate">
            {{ middleware.strategy?.meta.name || middleware.node.key }}
          </div>
        </div>

        @if (middleware.strategy?.meta.description) {
          <div class="text-text-tertiary text-xs font-body leading-snug line-clamp-2">
            {{ middleware.strategy?.meta.description | i18n }}
          </div>
        }
      </div>
    </div>
  }

  @if (!middlewares()?.length) {
    <div class="font-body text-text-tertiary text-sm px-2 py-3 text-center rounded-xl border border-dashed border-divider-regular">
      {{ 'PAC.Xpert.NoMiddlewares' | translate: {Default: 'No middlewares added yet'} }}
    </div>
  }
</div>
