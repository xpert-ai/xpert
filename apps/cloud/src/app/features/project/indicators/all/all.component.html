<div class="relative flex-1 overflow-x-auto">
  <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
    <thead class="text-sm text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
      <tr class="sticky top-0 left-0 bg-gray-50 dark:bg-gray-700 z-10">
        <th scope="col" class="p-4">
          <div class="flex items-center">
            <input id="checkbox-all-search" type="checkbox" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded-sm focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
              [ngModel]="allSelected()"
              (ngModelChange)="toggleAllSelection($event)">
            <label for="checkbox-all-search" class="sr-only">checkbox</label>
          </div>
        </th>
        <th scope="col" class="px-6 py-3">
          {{ 'PAC.KEY_WORDS.NAME' | translate: {Default: 'Name'} }}
        </th>
        <th scope="col" class="px-6 py-3">
          {{ 'PAC.KEY_WORDS.CODE' | translate: {Default: 'Code'} }}
        </th>
        <th scope="col" class="px-6 py-3">
          {{ 'PAC.KEY_WORDS.BUSINESS_AREA' | translate: {Default: 'Business Area'} }}
        </th>
        <th scope="col" class="px-6 py-3">
          {{ 'PAC.KEY_WORDS.CreatedAt' | translate: {Default: 'Created At'} }}
        </th>
        <th scope="col" class="px-6 py-3">
          {{ 'PAC.INDICATOR.REGISTER.Status' | translate: {Default: 'Status'} }}
        </th>
        <th scope="col" class="px-6 py-3">
          {{ 'PAC.INDICATOR.REGISTER.EmbeddingStatus' | translate: {Default: 'Embedding Status'} }}
        </th>
        <th scope="col" class="px-6 py-3">
          {{ 'PAC.INDICATOR.REGISTER.AvailableInApplication' | translate: {Default: 'App Available'} }}
        </th>
        <th scope="col" class="px-6 py-3">
          {{ 'PAC.INDICATOR.REGISTER.Visible' | translate: {Default: 'Visible'} }}
        </th>
        <th scope="col" class="px-6 py-3 sticky right-0 bg-gray-50 dark:bg-gray-700">
          {{ 'PAC.KEY_WORDS.ACTION' | translate: {Default: 'Action'} }}
        </th>
      </tr>
    </thead>
    <tbody>
      @for (row of indicators(); track row.id) {
        <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600">
          <td class="w-4 p-4">
            <div class="flex items-center">
              <input id="checkbox-table-search-1" type="checkbox" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded-sm focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                [ngModel]="isSelected(row)"
                (ngModelChange)="toggleSelection(row, $event)"
              >
              <label for="checkbox-table-search-1" class="sr-only">checkbox</label>
            </div>
          </td>
          <th scope="row" class="px-6 py-2 font-medium text-gray-900 whitespace-nowrap dark:text-white">
            <a class="cursor-pointer hover:underline" (click)="editIndicator(row.id)">
              <span>{{row.name}}</span>
            </a>
          </th>
          <td class="px-6 py-2">
            <span class="font-mono">{{ row.code }}</span>
          </td>
          <td class="px-6 py-2">
            {{ row.businessArea?.name }}
          </td>
          <td class="px-6 py-2">
           {{ row.createdAt | relative }}
          </td>
          <td class="px-6 py-2">
           <div class="inline-flex items-center gap-1 system-xs-semibold-uppercase">
            @switch (row.status) {
              @case (eIndicatorStatusEnum.DRAFT) {
                <div class="w-2 h-2 mr-1 border border-solid rounded-[3px] bg-orange-500 border-orange-700 shadow-[0_0_5px_-3px_rgba(249,112,102,0.1),0.5px_0.5px_3px_rgba(249, 112, 102, 0.2), inset_1.5px_1.5px_0_rgba(255, 255, 255, 0.4)]"></div>
                <span class="">{{ 'PAC.INDICATOR.Draft' | translate: {Default: 'Draft'} }}</span>
              }
              @case (eIndicatorStatusEnum.RELEASED) {
                <span class='w-2 h-2 mr-1 rounded-[2.5px] shadow-md bg-emerald-500 flex'></span>
                <span >{{ 'PAC.INDICATOR.Published' | translate: {Default: 'Published'} }}</span>
              }
              @case (eIndicatorStatusEnum.ARCHIVED) {
                <span class='w-2 h-2 mr-1 rounded-[2.5px] shadow-md bg-neutral-600 flex'></span>
                <span >({{ 'PAC.INDICATOR.Archived' | translate: {Default: 'Archived'} }})</span>
              }
              @default {
                <span class="text-neutral-500">({{ 'PAC.INDICATOR.Unknown' | translate: {Default: 'Unknown'} }})</span>
              }
            }
            </div>
          </td>
          <td class="px-6 py-2">
            @switch (row.embeddingStatus) {
              @case (eEmbeddingStatusEnum.SUCCESS) {
                <div class="inline-flex items-center gap-1 system-xs-semibold-uppercase">
                  <span class='w-2 h-2 mr-1 rounded-[2.5px] shadow-md bg-emerald-500 flex'></span>
                  <span class="">
                    {{ 'PAC.MODEL.Success' | translate: {Default: 'Success'} }}
                  </span>
                </div>
              }
              @case (eEmbeddingStatusEnum.FAILED) {
                <div class="inline-flex items-center gap-1 system-xs-semibold-uppercase">
                  <div class="w-2 h-2 mr-1 border border-solid rounded-[3px] bg-red-400 border-red-600 shadow-[0_0_5px_-3px_rgba(249,112,102,0.1),0.5px_0.5px_3px_rgba(249, 112, 102, 0.2), inset_1.5px_1.5px_0_rgba(255, 255, 255, 0.4)]"></div>
                  <span class="text-red-500">
                    {{ row.error }}
                  </span>
                </div>
              }
              @case (eEmbeddingStatusEnum.PROCESSING) {
                <div class="inline-flex items-center gap-1 system-xs-semibold-uppercase">
                  <i class="ri-loader-2-line flex justify-center items-center w-3.5 h-3.5 animate-spin"></i>
                  <span class="">
                    {{ 'PAC.MODEL.Running' | translate: {Default: 'Running'} }}
                  </span>
                </div>
              }
              @default {
                <div class="inline-flex items-center gap-1 system-xs-semibold-uppercase">
                  <div class="w-2 h-2 mr-1 border border-solid rounded-[3px] bg-neutral-500 border-neutral-800 shadow-[0_0_5px_-3px_rgba(249,112,102,0.1),0.5px_0.5px_3px_rgba(249, 112, 102, 0.2), inset_1.5px_1.5px_0_rgba(255, 255, 255, 0.4)]"></div>
                  <span class="">
                    {{ 'PAC.MODEL.NotIndexed' | translate: {Default: 'Not indexed'} }}
                  </span>
                </div>
              }
            }
          </td>
          <td class="px-6 py-2">
            {{ row.isApplication ? 'Yes' : 'No' }}
          </td>
          <td class="px-6 py-2">
            {{ row.visible ? 'Yes' : 'No' }}
          </td>
          <td class="px-6 py-2 text-lg sticky right-0 bg-gray-50 dark:bg-gray-700">
            <div class="pac__table-actions flex gap-1 group">
              <button type="button" class="w-8 h-8 rounded-full text-slate-500 hover:bg-hover-bg opacity-50 group-hover:opacity-100"
                (click)="editIndicator(row.id)">
                <i class="ri-pencil-line"></i>
              </button>
              <button type="button" class="w-8 h-8 rounded-full text-slate-500 enabled:hover:bg-hover-bg opacity-50 enabled:group-hover:opacity-100"
                [disabled]="!row.draft"
                [matTooltip]="row.draft ? ('PAC.Project.PublishTooltip' | translate: {Default: 'Publish the draft to the production version.'}) : ('PAC.Project.PublishDraftTooltip' | translate: {Default: 'Only draft indicators can be published.'})"
                matTooltipPosition="above"
                (click)="publish(row)">
                <i class="ri-send-plane-line"></i>
              </button>

              <button type="button" class="w-8 h-8 rounded-full text-slate-500 enabled:hover:bg-hover-bg opacity-50 enabled:group-hover:opacity-100"
                [disabled]="row.status !== eIndicatorStatusEnum.RELEASED"
                [matTooltip]="row.status === eIndicatorStatusEnum.RELEASED ? ('PAC.Project.EmbeddingTooltip' | translate: {Default: 'Embed indicator into vector store for semantic retrieval.'}) : ('PAC.Project.EmbedReleasedTooltip' | translate: {Default: 'Only released indicators can be embedded.'})"
                matTooltipPosition="above"
                (click)="embedding(row)">
                <i class="ri-ai-generate-text"></i>
              </button>

              <div class="h-2 w-[1px] bg-components-card-bg mx-1 my-auto"></div>

              <button type="button" class="w-8 h-8 rounded-full text-slate-500 hover:bg-hover-bg hover:text-text-destructive opacity-50 group-hover:opacity-100 duration-300"
                (click)="onDelete({id: row.id, name: row.name})">
                <i class="ri-delete-bin-line"></i>
              </button>
            </div>
          </td>
        </tr>
      }
    </tbody>
  </table>
</div>
<!-- <div class="p-2 flex justify-end">
  <nav class="flex items-center flex-column flex-wrap md:flex-row justify-between pt-4" aria-label="Table navigation">
    <span class="text-sm font-normal text-gray-500 dark:text-gray-400 mb-4 md:mb-0 block w-full md:inline md:w-auto">Showing <span class="font-semibold text-gray-900 dark:text-white">1-10</span> of <span class="font-semibold text-gray-900 dark:text-white">1000</span></span>
    <ul class="inline-flex -space-x-px rtl:space-x-reverse text-sm h-8">
      <li>
          <a href="#" class="flex items-center justify-center px-3 h-8 ms-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">Previous</a>
      </li>
      <li>
          <a href="#" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">1</a>
      </li>
      <li>
          <a href="#" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">2</a>
      </li>
      <li>
          <a href="#" aria-current="page" class="flex items-center justify-center px-3 h-8 text-blue-600 border border-gray-300 bg-blue-50 hover:bg-blue-100 hover:text-blue-700 dark:border-gray-700 dark:bg-gray-700 dark:text-white">3</a>
      </li>
      <li>
          <a href="#" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">4</a>
      </li>
      <li>
          <a href="#" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">5</a>
      </li>
      <li>
        <a href="#" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 rounded-e-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">Next</a>
      </li>
    </ul>
  </nav>
</div> -->

@if (hasSelected()) {
  <div class="absolute bottom-12 w-full px-16 py-2 z-10">
    <div class="rounded-xl flex justify-center items-center gap-4 p-2 shadow-lg border-[0.5px] border-solid border-divider-deep bg-neutral-200">
      <div>
        {{selectedIndicators().length}} {{ 'PAC.Project.Indicators' | translate: {Default: 'Indicators'} }}
      </div>
      <button type="button" class="btn btn-large" 
        (click)="exportSelected()">
        <i class="ri-download-2-line mr-1"></i>
        {{ 'PAC.INDICATOR.MY_INDICATORS.EXPORT' | translate: {Default: "Export"} }}
      </button>
      <button type="button" class="btn btn-large danger" (click)="bulkDelete(selectedIndicators())">
        <i class="ri-delete-bin-line mr-1"></i>
        {{ 'PAC.ACTIONS.Delete' | translate: {Default: 'Delete'} }}
      </button>
    </div>
  </div>
}

@if (loading()) {
  <ngm-spin class="absolute w-full h-full top-0 left-0"/>
}
