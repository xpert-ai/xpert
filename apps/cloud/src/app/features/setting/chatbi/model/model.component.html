<div class="shrink-0 w-full h-28" (click)="close()"></div>
<div class="relative w-full flex-1 flex flex-col justify-start items-center rounded-t-3xl bg-gray-50 overflow-auto">
  <div class="flex-1 max-w-lg pt-4">
    <div class="w-full text-lg font-medium p-4 text-left">{{'PAC.ChatBI.NewChatBIModel' | translate: {Default: 'New ChatBI Model'} }}</div>

    <form class="flex flex-wrap gap-4 p-4" [formGroup]="formGroup">
      <div class="flex-1">
        <ngm-select class="w-full" 
          [class.ngm-select-error]="modelIdInvalid()"
          [label]="'PAC.ChatBI.SemanticModel' | translate: {Default: 'Semantic Model'}" 
          [placeholder]="'PAC.ChatBI.PleaseSelectSemanticModel' | translate: {Default: 'Please select a semantic model'}"
          valueKey="key"
          [displayBehaviour]="DisplayBehaviour.descriptionOnly"
          formControlName="modelId"
          searchable
          [selectOptions]="models()"
        >
          <a help (click)="openSemanticModelPage($event)" class="inline-flex items-center p-1 text-xs !text-primary-400 hover:!text-primary-600 cursor-pointer">
            {{'PAC.Xpert.HowtoCreate' | translate: {Default: 'How to create'} }}
            <i class="ri-external-link-line"></i>
          </a>
          
          @if (hasNoModels()) {
            <div ngmError class="flex flex-col gap-2">
              <div>{{'PAC.ChatBI.NoSemanticModelsAvailable' | translate: {Default: 'No semantic models available, please create a semantic model first'} }}</div>
              <a (click)="openSemanticModelPage($event)" 
                class="inline-flex items-center gap-1 text-xs text-primary-500 hover:text-primary-600 underline cursor-pointer">
                {{'PAC.ChatBI.CreateSemanticModel' | translate: {Default: 'Create Semantic Model'} }}
                <i class="ri-external-link-line"></i>
              </a>
            </div>
          }
        </ngm-select>
      </div>
      
      <ngm-select class="flex-1" 
        [class.ngm-select-error]="entityInvalid()"
        [label]="'PAC.ChatBI.Entity' | translate: {Default: 'Entity'}" 
        [placeholder]="'PAC.ChatBI.PleaseSelectEntity' | translate: {Default: 'Please select an entity'}"
        valueKey="key"
        [displayBehaviour]="DisplayBehaviour.descriptionOnly"
        formControlName="entity"
        searchable
        [selectOptions]="entities()"
      >
        @if (addEntityRoute()) {
          <a help (click)="openAddEntityPage($event, addEntityRoute())" class="inline-flex items-center p-1 text-xs !text-primary-400 hover:!text-primary-600 cursor-pointer">
            {{'PAC.ChatBI.AddEntity' | translate: {Default: 'Add Entity'} }}
            <i class="ri-external-link-line"></i>
          </a>
        }
        
        @if (hasNoEntities()) {
          <div ngmError>
            <div>{{'PAC.ChatBI.NoEntitiesAvailable' | translate: {Default: 'No entities available, please add an entity first'} }}</div>
          </div>
        } @else if (entityNotFound()) {
          <div ngmError>{{'PAC.ChatBI.EntityNotFound' | translate: {Default: 'Entity not found'} }}</div>
        }
      </ngm-select>
          
      <ngm-input class="flex-1 min-w-full" [label]="'PAC.ChatBI.Caption' | translate: {Default: 'Caption'}" valueKey="key"
        formControlName="entityCaption"
      />
      
      <div class="flex-1 min-w-full flex flex-col">
        <label class="ngm-input-label shrink-0">{{'PAC.ChatBI.Description' | translate: {Default: 'Description'} }}</label>
        <textarea class="ngm-input-element" matInput formControlName="entityDescription"
          cdkTextareaAutosize
          cdkAutosizeMinRows="1"
          cdkAutosizeMaxRows="5">
        </textarea>
      </div>
    </form>
  </div>

  <div class="w-full sticky bottom-0 flex justify-center bg-gray-50">
    <div class="max-w-lg flex justify-between items-center p-4">
      <div></div>
      <div ngmButtonGroup>
        <button mat-button (click)="close()">{{'PAC.KEY_WORDS.Cancel' | translate: {Default: 'Cancel'} }}</button>
        <button mat-raised-button color="primary" [disabled]="loading() || formGroup.invalid || formGroup.pristine || entityNotFound()"
          (click)="saveAll()"
        >{{'PAC.KEY_WORDS.Save' | translate: {Default: 'Save'} }}</button>
      </div>
    </div>
  </div>
</div>

@if (loading()) {
  <ngm-spin class="absolute w-full h-full flex justify-center items-center"></ngm-spin>
}