<mat-accordion>
  @for (feature of features$ | async; track feature.code) {
	<mat-expansion-panel hideToggle class="mat-elevation-z group/item"
		[disabled]="!enabledFeature(feature)">
	  <mat-expansion-panel-header>
		<mat-panel-title>
		  <span>
			{{ 'PAC.Feature.Features.' + feature.code + '.Name' | translate: {Default: feature.name } }}
		  </span>
		</mat-panel-title>

		<mat-panel-description class="flex justify-end items-center">
		  {{ 'PAC.Feature.Features.' + feature.code + '.Description' | translate: {Default: feature.description } }}
		</mat-panel-description>

		<button type="button" class="btn btn-secondary w-7 h-7 rounded-full flex justify-center items-center
		   text-text-secondary hover:text-text-primary shadow-none hover:shadow-sm border-transparent group-hover/item:border-neutral-200"
		  [cdkMenuTriggerFor]="menu"
		  [cdkMenuTriggerData]="{feature: feature}"
		  (click)="$event.stopPropagation()">
		  <i class="ri-more-line"></i>
		</button>
	  </mat-expansion-panel-header>
	
	@if (feature.children?.length > 0) {
	  <mat-list displayDensity="cosy">
		@for (child of feature.children; track child.code) {
		  <mat-list-item>
			<mat-checkbox [checked]="enabledFeature(child)" (change)="featureChanged($event.checked, child)">
				<div class="flex items-center gap-4">
					<span>{{ 'PAC.Feature.Features.' + child.code + '.Name' | translate: {Default: child.name } }}</span>
					<span class="text-sm italic">{{ 'PAC.Feature.Features.' +  child.code + '.Description' | translate: {Default: child.description } }}</span>
				</div>
			</mat-checkbox>
		  </mat-list-item>
	    }
	  </mat-list>
	}
	</mat-expansion-panel>

	<ng-template #menu >
	  <div cdkMenu class="cdk-menu__large">
		@if (enabledFeature(feature)) {
		  <button type="button" cdkMenuItem class="" (click)="featureChanged(false, feature)">
			<i class="ri-toggle-fill mr-1"></i>
			<span>{{ 'PAC.ACTIONS.Disable' | translate: {Default: 'Disable'} }}</span>
		  </button>
		} @else {
		  <button type="button" cdkMenuItem class="" (click)="featureChanged(true, feature)">
			<i class="ri-toggle-line mr-1"></i>
			<span>{{ 'PAC.ACTIONS.Enable' | translate: {Default: 'Enable'} }}</span>
		  </button>
		}
	  </div>
	</ng-template>
  }
</mat-accordion>

@if (loading()) {
  <div class="absolute left-0 top-0 w-full h-full flex justify-center items-center">
	<mat-progress-spinner [mode]="'indeterminate'" [diameter]="22" color="accent" />
  </div>
}